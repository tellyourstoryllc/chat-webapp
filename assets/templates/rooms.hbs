{{! Mention notification audio tag. }}
<audio preload='auto' class='mention-sound'>
  <source src='{{webServerUrl '/audio/mention_sound.mp4'}}'>
  <source src='{{webServerUrl '/audio/mention_sound.wav'}}'>
</audio>
{{! Received regular message audio tag. }}
<audio preload='auto' class='receive-message-sound'>
  <source src='{{webServerUrl '/audio/receive.m4a'}}'>
</audio>

<div class='rooms-sidebar'>
  <div class='toggle-sidebar-tab'>
    <span class='toggle-sidebar-icon'></span>
  </div>

  <div class='logo'>
    {{#link-to 'index'}}
      <img src='{{webServerUrl '/images/logo.png'}}' alt='{{unbound App.title}}' style='width: 49px; height: auto;'>
    {{/link-to}}
  </div>
  <div class='join-text-container'>
    <input type='text' class='join-text' placeholder='Enter RoomÂ (Room Key)' autocomplete='off'>
  </div>
  <ul class='rooms-list'>
    <li class='room-list-item'>
      <a href='#' {{action 'showCreateRoomDialog'}}>
        <span class='create-room-icon'></span>
        <div class='room-name create-room-name'>Create Room</div>
      </a>
    </li>
    {{#if roomsLoaded}}
      {{#each room in arrangedRooms}}
        <li {{bind-attr class=':room-list-item room.isUnread:unread:read view.showAvatars::avatars-off'}} {{action 'requestNotificationPermission'}}>
          {{#link-to 'rooms.room' room}}
            {{room-avatar room=room showStatus=true}}
            <div class='room-name'>{{room.name}}</div>
            <span {{bind-attr class=':room-door-icon room.isRoom::hidden'}}></span>
            <div class='room-status'>{{room.statusText}}</div>
            <div class='clearfix'></div>
          {{/link-to}}
        </li>
      {{/each}}
    {{else}}
      Loading...
    {{/if}}
  </ul>

  <div class='current-user-status-bar'>
    <div {{bind-attr class=':current-user-status-cell view.showAvatars::avatars-off'}} {{action 'toggleChooseStatusMenu' target='view' bubbles=false}}>
      <div class='current-user-status'>
        {{room-avatar room=currentUser showStatus=true}}
        <div class='username'>{{currentUser.name}}</div>
        <div class='status-text'>{{currentUser.statusText}}</div>
        <div class='clearfix'></div>
      </div>
    </div>
    <div class='settings-icon-cell' {{action 'showSettings'}}>
      <span class='settings-icon'></span>
    </div>
  </div>
</div>

<ul class='menu choose-status-menu' role='menu'>
  {{#each status in App.User.statuses}}
    <li class='menu-item' {{action 'setStatus' status target='view'}}>
      <span {{bind-attr class=':room-avatar :blank-avatar status.name'}}></span>
      {{status.title}}
    </li>
  {{/each}}
  <li class='separator'></li>
  <li class='menu-item' {{action 'changeStatusText' target='view' bubbles=false}}>
    Change Status Message...
  </li>
  <li class='separator'></li>
  <li class='menu-item' {{action 'logOut' target='view'}}>Log Out</li>
</ul>

<ul class='menu status-text-menu' role='menu'>
  <li class='menu-item'>
    <form {{action 'saveStatusText' target=view on='submit'}}>
      {{! Cancel bubbling so that clicking on the textbox doesn't close the menu. }}
      <input type='text' class='new-status-text' {{action 'ignore' bubbles=false}}
        maxlength='160'>
      <button type='submit' class='save-status-text-button'>Save</button>
      <div class='clearfix'></div>
    </form>
  </li>
</ul>

<div {{bind-attr class=':room-content view.isRoomContentOutOfTheWay:out-of-the-way'}}>
  {{outlet}}

  {{rooms-container rooms=rooms activeRoom=activeRoom didGoToRoom='goToRoom'}}

  <div {{bind-attr class=':room-members-sidebar activeRoom::hidden'}}>
    {{! Always render the file input so that event listeners can bind to it. }}
    <input type='file' class='room-avatar-file' style='display: none;'>
    <input type='file' class='room-wallpaper-file' style='display: none;'>
    {{#if activeRoom}}
      <div {{bind-attr class=':one-to-one-specific isActiveRoomOneToOne::hidden'}}>
        <div class='room-avatar big-one-to-one-avatar' {{bind-attr style='activeRoomAvatarStyle'}}></div>
        <div class='username'>{{activeRoom.name}}</div>
        <div class='status-text'>{{activeRoom.statusText}}</div>
      </div>

      <div {{bind-attr class=':room-specific isActiveRoomOneToOne:hidden'}}>
        <div class='title admin-title'>Admin</div>
        <div class='room-actions admin-room-actions' {{action 'toggleRoomMenu' target=view bubbles=false}}>
          <span class='room-settings-icon'></span>
          Room Settings
        </div>

        <div class='invite-button-container'>
          <button class='app-btn btn-green btn-block btn-flat' {{action 'toggleInviteDialog' target=view bubbles=false}}>
            Invite
          </button>
        </div>
      </div>
    {{/if}}

    <div {{bind-attr class=':room-specific isActiveRoomOneToOne:hidden'}}>
      <div class='title'>People</div>
      {{#if usersLoaded}}
        <ul class='room-members'>
          {{#each user in arrangedMembers}}
            <li class='room-member'>
              {{#link-to 'rooms.room' user classNames='room-member-link'
                classNameBindings='view.showAvatars::avatars-off'}}
                <div class='room-member-avatar-cell'>
                  {{room-avatar room=user showStatus=true}}
                </div>
                <div class='room-member-info-cell'>
                  <span class='username'>{{user.name}}</span>
                  {{#if user.shouldDisplayIdleDuration}}
                    <span class='idle-duration'>{{duration user.mostRecentIdleDuration}}</span>
                  {{/if}}
                  {{#if user.statusText}}
                    <div class='status-text'>{{user.statusText}}</div>
                  {{/if}}
                </div>
                <div class='clearfix'></div>
              {{/link-to}}
            </li>
          {{/each}}
        </ul>
      {{else}}
        <div class='loading'>
          Loading...
        </div>
      {{/if}}
    </div>
  </div>
</div>

<ul class='menu room-menu' role='menu'>
  <li {{bind-attr class=':menu-item view.canUpdateRoomAvatar::disabled'}}
    {{action 'chooseRoomAvatar' target=view}}>Change Room Avatar...</li>
  {{#if view.hasRoomAvatar}}
    <li {{bind-attr class=':menu-item view.canUpdateRoomAvatar::disabled'}}
      {{action 'removeRoomAvatar' target=view}}>Remove Room Avatar</li>
  {{/if}}
  <li {{bind-attr class=':menu-item view.canUpdateRoomWallpaper::disabled'}}
    {{action 'chooseRoomWallpaper' target=view}}>Change Wallpaper...</li>
  {{#if view.hasRoomWallpaper}}
    <li {{bind-attr class=':menu-item view.canUpdateRoomWallpaper::disabled'}}
      {{action 'removeRoomWallpaper' target=view}}>Remove Wallpaper</li>
  {{/if}}
  <li class='separator'></li>
  <li class='menu-item' {{action 'leaveRoom' target=view}}>Leave Room...</li>
</ul>

<div class='dialog invite-dialog' {{action 'ignore' bubbles=false}}>
  <div class='close' {{action 'dismissInviteDialog' target=view}} title='Close'>
    &times;
  </div>
  <div class='instructions'>
    You can invite people to join this room by sending this link:
  </div>
  <div class='join-link-container'>
    <input type='text' {{bind-attr value='activeRoom.joinUrl'}} class='join-url-text' readonly>
  </div>
  <button class='app-btn btn-block btn-green btn-flat copy-join-link-button' {{bind-attr data-clipboard-text='activeRoom.joinUrl'}}>
    <span class='copy-icon'></span>
    Copy Link to Clipboard
  </button>
  <div class='copy-to-clipboard-indicator'>
    Copied to Clipboard
  </div>
</div>
