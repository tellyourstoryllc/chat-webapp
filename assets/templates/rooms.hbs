{{! Mention notification audio tag. }}
<audio preload='auto' class='mention-sound'>
  <source src='{{webServerUrl '/audio/mention_sound.mp4'}}'>
  <source src='{{webServerUrl '/audio/mention_sound.wav'}}'>
</audio>
{{! Received regular message audio tag. }}
<audio preload='auto' class='receive-message-sound'>
  <source src='{{webServerUrl '/audio/receive.m4a'}}'>
</audio>

{{#if isAppleIos}}
  <div class='app-install-banner temporarily-hidden'>
    <div class='close' {{action 'dismissAppInstallBanner' target=view}}>&times;</div>
    <img src='{{webServerUrl 'imageLogo'}}' alt='{{unbound App.title}}' style='width: 49px; height: 32px; padding-top: 2px' class='app-install-logo'>
    <div class='pull-right' style='margin: 10px 0'>
      <span class='for-platform'></span>
      <a class='app-btn btn-flat btn-green' href='https://itunes.apple.com/us/app/skymob-best-app-for-group/id778593574?ls=1&mt=8' target='_blank'>
        Install App
      </a>
    </div>
    <div class='clearfix'></div>
  </div>
{{/if}}

<div class='rooms-sidebar'>
  <div class='toggle-sidebar-tab'>
    <span class='toggle-sidebar-icon'></span>
  </div>

  <div class='logo'>
    {{#link-to 'index'}}
      <img src='{{webServerUrl 'imageLogo'}}' alt='{{unbound App.title}}' style='width: 49px; height: 32px;'>
    {{/link-to}}
  </div>
  <div class='join-text-container'>
    <input type='text' class='join-text' placeholder='Enter RoomÂ (Room Key)' autocomplete='off'>
  </div>
  <ul class='rooms-list'>
    <li class='room-list-item'>
      <a href='#' {{action 'showCreateRoomDialog'}}>
        <span class='create-room-icon'></span>
        <div class='room-name create-room-name'>Create Room</div>
      </a>
    </li>
    {{#if roomsLoaded}}
      {{#each room in arrangedRooms}}
        <li {{bind-attr class=':room-list-item room.isUnread:unread:read view.showAvatars::avatars-off'}} {{action 'requestNotificationPermission'}}>
          {{#link-to 'rooms.room' room}}
            <div class='active-indicator'></div>
            {{room-avatar room=room showStatus=true}}
            <div class='room-name'>{{room.name}}</div>
            <span {{bind-attr class=':room-door-icon room.isRoom::hidden'}}></span>
            <div class='room-status'>{{room.statusText}}</div>
            <div class='clearfix'></div>
          {{/link-to}}
        </li>
      {{/each}}
    {{else}}
      Loading...
    {{/if}}
  </ul>

  <div class='current-user-status-bar'>
    <div {{bind-attr class=':current-user-status-cell view.showAvatars::avatars-off'}} {{action 'toggleChooseStatusMenu' target='view' bubbles=false}}>
      <div class='current-user-status'>
        {{room-avatar room=currentUser showStatus=true}}
        <div class='username'>{{currentUser.name}}</div>
        <div class='status-text'>{{currentUser.statusText}}</div>
        <div class='clearfix'></div>
      </div>
    </div>
    <div class='settings-icon-cell' {{action 'showSettings'}}>
      <span class='settings-icon'></span>
    </div>
  </div>
</div>

<ul class='menu choose-status-menu' role='menu'>
  {{#each status in App.User.statuses}}
    <li class='menu-item' {{action 'setStatus' status target='view'}}>
      <span {{bind-attr class=':room-avatar :blank-avatar status.name'}}></span>
      {{status.title}}
    </li>
  {{/each}}
  <li class='separator'></li>
  <li class='menu-item' {{action 'changeStatusText' target='view' bubbles=false}}>
    Change Status Message...
  </li>
  <li class='separator'></li>
  <li class='menu-item' {{action 'logOut' target='view'}}>Log Out</li>
</ul>

<ul class='menu status-text-menu' role='menu'>
  <li class='menu-item'>
    <form {{action 'saveStatusText' target=view on='submit'}}>
      {{! Cancel bubbling so that clicking on the textbox doesn't close the menu. }}
      <input type='text' class='new-status-text' {{action 'ignore' bubbles=false}}
        maxlength='160'>
      <button type='submit' class='save-status-text-button'>Save</button>
      <div class='clearfix'></div>
    </form>
  </li>
</ul>

<div {{bind-attr class=':room-content view.isRoomContentOutOfTheWay:out-of-the-way'}}>
  {{outlet}}

  {{rooms-container rooms=rooms activeRoom=activeRoom didGoToRoom='goToRoom'
    didCloseRoom='closeRoom' didToggleRoomsSidebar='toggleRoomsSidebar'}}
</div>
